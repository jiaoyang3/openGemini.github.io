import{_ as p,X as o,Y as t,$ as s,a1 as n,Z as l,a3 as a,C as r}from"./framework-1e2d737a.js";const c={},k=a('<p>本章主要介绍如下函数：</p><table><thead><tr><th>选择函数</th><th>说明</th></tr></thead><tbody><tr><td><a href="#first">FIRST()</a></td><td>最晚一条数据</td></tr><tr><td><a href="#last">LAST()</a></td><td>最晚一条数据</td></tr><tr><td><a href="#min">MIN()</a></td><td>最小值</td></tr><tr><td><a href="#max">MAX()</a></td><td>最大值</td></tr><tr><td><a href="#top">TOP()</a></td><td>最大N个值</td></tr><tr><td><a href="#bottom">BOTTOM()</a></td><td>最小N个值</td></tr><tr><td><a href="#percentile">PERCENTILE()</a></td><td>计算百分位数</td></tr><tr><td><a href="#sample">SAMPLE()</a></td><td>N个随机样本</td></tr><tr><td><a href="#percentile-ogsketch"><strong>PERCENTILE_OGSKETCH()</strong></a></td><td>近似分位数</td></tr></tbody></table>',2),u={class:"hint-container tip"},i=s("p",{class:"hint-container-title"},"提示",-1),d={href:"https://docs.influxdata.com/influxdb/v1/query_language/functions",target:"_blank",rel:"noopener noreferrer"},m=a(`<p>时间戳默认显示为整数，希望时间戳显示格式为rfc3339：“YYYY-MM-DD&#39;T&#39;hh:mm:ss.XXX”，在ts-cli中执行命令</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">precision</span> rfc3339
<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">FIRST</span><span class="token punctuation">(</span><span class="token string">&quot;level description&quot;</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+----------------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> <span class="token keyword">first</span>                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+----------------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">17</span>T00:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">6</span> <span class="token operator">and</span> <span class="token number">9</span> feet <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+----------------------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),b=a(`<h2 id="first" tabindex="-1"><a class="header-anchor" href="#first" aria-hidden="true">#</a> FIRST()</h2><p>返回指定Field列最早时间的值，不支持对Tag进行计算，不支持SLIMIT和SOFFSET。</p><p><strong>语法</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">FIRST</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>field_key<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>tag_key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token operator">|</span><span class="token operator">&lt;</span>field_key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>INTO_CLAUSE<span class="token punctuation">]</span> FROM_CLAUSE <span class="token punctuation">[</span>WHERE_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>GROUP_BY_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>ORDER_BY_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>LIMIT_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>OFFSET_CLAUSE<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>示例</strong></p><p><strong>选择指定Field对应的具有最早时间戳的值</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">FIRST</span><span class="token punctuation">(</span><span class="token string">&quot;level description&quot;</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">---------------------+----------------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                <span class="token operator">|</span> <span class="token keyword">first</span>                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+----------------------+</span>
<span class="token operator">|</span> <span class="token number">1566000000000000000</span> <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">6</span> <span class="token operator">and</span> <span class="token number">9</span> feet <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+----------------------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该查询返回 <code>level description</code>列最早时间戳的值。</p><p><strong>选择表中所有Field列对应最早时间戳的值</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">FIRST</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">------+-------------------------+-------------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span> <span class="token operator">|</span> first_level description <span class="token operator">|</span> first_water_level <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------------------+-------------------+</span>
<span class="token operator">|</span> <span class="token number">0</span>    <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">6</span> <span class="token operator">and</span> <span class="token number">9</span> feet    <span class="token operator">|</span> <span class="token number">8.12</span>              <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------------------+-------------------+</span>
<span class="token number">3</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>选择与正则表达式匹配的每个Field列对应最早时间戳的值</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">FIRST</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token keyword">level</span><span class="token operator">/</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+-------------------------+-------------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> first_level description <span class="token operator">|</span> first_water_level <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------------------------+-------------------+</span>
<span class="token operator">|</span> <span class="token number">1970</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>T00:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">6</span> <span class="token operator">and</span> <span class="token number">9</span> feet    <span class="token operator">|</span> <span class="token number">8.12</span>              <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------------------------+-------------------+</span>
<span class="token number">3</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该查询返回表 <code>h2o_feet</code>中包含单词<code>level</code>的所有Field对应最早时间戳的值。</p><blockquote><p>FIRST(*)返回的时间为0，因为应用写入的数据未必包含全部的列，换句话说，可能每一列的最早数据的时间是不同的。</p></blockquote><p><strong>选择指定Field列最早的数据，和及其相关的Tag和Field</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">FIRST</span><span class="token punctuation">(</span><span class="token string">&quot;level description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;location&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;water_level&quot;</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+----------------------+--------------+-------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> <span class="token keyword">first</span>                <span class="token operator">|</span> location     <span class="token operator">|</span> water_level <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+----------------------+--------------+-------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">17</span>T00:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">6</span> <span class="token operator">and</span> <span class="token number">9</span> feet <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> <span class="token number">8.12</span>        <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+----------------------+--------------+-------------+</span>
<span class="token number">4</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>指定时间范围分组查询指定Field列的最早时间的值</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">FIRST</span><span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span> <span class="token keyword">WHERE</span> <span class="token keyword">time</span> <span class="token operator">&gt;=</span> <span class="token string">&#39;2019-08-20T00:12:01Z&#39;</span> <span class="token operator">AND</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token string">&#39;2019-08-20T08:00:00Z&#39;</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">time</span><span class="token punctuation">(</span><span class="token number">7</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span> fill<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token keyword">LIMIT</span> <span class="token number">4</span>
name: h2o_feet
tags: location<span class="token operator">=</span>coyote_creek
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> <span class="token keyword">first</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">10</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">1000</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">17</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.684</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">24</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.661</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">31</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.619</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该查询返回表 <code>h2o_feet</code>中 <code>water_level</code> 列对应的最早时间戳的值（Field value），指定时间范围为<code>2019-08-20T00:12:01Z</code>和<code>2019-08-20T08:00:00Z</code>，并将查询结果按7分钟的时间间隔和每个Tag进行分组，同时，若分组为空值，用<code>1000</code>填充，并将返回4条结果数据。</p><h2 id="last" tabindex="-1"><a class="header-anchor" href="#last" aria-hidden="true">#</a> LAST()</h2><p>返回指定Filed列最新写入的数据。不支持对Tag进行计算，不支持SLIMIT和SOFFSET。</p><p><strong>语法</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">LAST</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>field_key<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>tag_key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token operator">|</span><span class="token operator">&lt;</span>field_keys<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>INTO_CLAUSE<span class="token punctuation">]</span> FROM_CLAUSE <span class="token punctuation">[</span>WHERE_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>GROUP_BY_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>ORDER_BY_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>LIMIT_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>OFFSET_CLAUSE<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>示例</strong></p><p><strong>选择<code>level description</code>列最新写入数据</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">LAST</span><span class="token punctuation">(</span><span class="token string">&quot;level description&quot;</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+----------------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> <span class="token keyword">last</span>                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+----------------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">17</span>T21:<span class="token number">42</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">3</span> <span class="token operator">and</span> <span class="token number">6</span> feet <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+----------------------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>

<span class="token comment">#对比FIRST()查询最早写入的数据</span>
<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">FIRST</span><span class="token punctuation">(</span><span class="token string">&quot;level description&quot;</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+----------------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> <span class="token keyword">first</span>                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+----------------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">17</span>T00:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">6</span> <span class="token operator">and</span> <span class="token number">9</span> feet <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+----------------------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>查询每列最新写入的数据</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">LAST</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+------------------------+------------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> last_level description <span class="token operator">|</span> last_water_level <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+------------------------+------------------+</span>
<span class="token operator">|</span> <span class="token number">1970</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>T00:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">3</span> <span class="token operator">and</span> <span class="token number">6</span> feet   <span class="token operator">|</span> <span class="token number">4.938</span>            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+------------------------+------------------+</span>
<span class="token number">3</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>LAST(*)返回的时间为0，因为应用写入的数据未必包含全部的列，换句话说，可能每一列的最新数据的时间是不同的。</p></blockquote><p><strong>选择指定Field列最新的数据，和及其相关的Tag和Field</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">LAST</span><span class="token punctuation">(</span><span class="token string">&quot;level description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;location&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;water_level&quot;</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+----------------------+--------------+-------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> <span class="token keyword">last</span>                 <span class="token operator">|</span> location     <span class="token operator">|</span> water_level <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+----------------------+--------------+-------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">17</span>T21:<span class="token number">42</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">3</span> <span class="token operator">and</span> <span class="token number">6</span> feet <span class="token operator">|</span> santa_monica <span class="token operator">|</span> <span class="token number">4.938</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+----------------------+--------------+-------------+</span>
<span class="token number">4</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该查询返回measurement <code>h2o_feet</code>中field key <code>level description</code>对应的具有最新时间戳的field value，以及相关的tag key <code>location</code>和field key <code>water_level</code>的值。</p><p><strong>指定时间范围分组查询每一组的最新数据</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">LAST</span><span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span> <span class="token keyword">WHERE</span> <span class="token keyword">time</span> <span class="token operator">&gt;=</span> <span class="token string">&#39;2019-08-20T00:12:01Z&#39;</span> <span class="token operator">AND</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token string">&#39;2019-08-20T08:00:00Z&#39;</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">time</span><span class="token punctuation">(</span><span class="token number">7</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span> fill<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token keyword">LIMIT</span> <span class="token number">4</span>
name: h2o_feet
tags: location<span class="token operator">=</span>coyote_creek
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> <span class="token keyword">last</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">10</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">1000</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">17</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.684</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">24</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.655</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">31</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.619</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该查询返回表 <code>h2o_feet</code>中 <code>water_level</code> 列对应的最新的值（Field value），指定时间范围为<code>2019-08-20T00:12:01Z</code>和<code>2019-08-20T08:00:00Z</code>，并将查询结果按7分钟的时间间隔和每个Tag进行分组，同时，若分组为空值，用<code>1000</code>填充，并将返回4条结果数据。</p><h2 id="max" tabindex="-1"><a class="header-anchor" href="#max" aria-hidden="true">#</a> MAX()</h2><p>返回指定Field列的最大值，不支持对Tag进行计算，不支持SLIMIT和SOFFSET。</p><p><strong>语法</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>field_key<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>tag_key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token operator">|</span><span class="token operator">&lt;</span>field__key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>INTO_CLAUSE<span class="token punctuation">]</span> FROM_CLAUSE <span class="token punctuation">[</span>WHERE_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>GROUP_BY_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>ORDER_BY_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>LIMIT_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>OFFSET_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>SLIMIT_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>SOFFSET_CLAUSE<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>示例</strong></p><p><strong>查询指定Field列的最大值</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> max   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T07:<span class="token number">24</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">9.964</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>查询所有列的最大值</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+-----------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> max_water_level <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-----------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T07:<span class="token number">24</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">9.964</span>           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-----------------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>表h2o_feet共有Field列两个：<code>water_level</code>和<code>level_description</code>，<code>MAX</code>仅支持对数值类型进行计算，因此不会有<code>level_description</code>。此外，如果存在数值类型的多列，返回值的<code>time</code>则为0，因为每列最大值所对应的时间可能不一致。</p><p><strong>正则表达式使用</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token keyword">level</span><span class="token operator">/</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+-----------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> max_water_level <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-----------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T07:<span class="token number">24</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">9.964</span>           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-----------------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该查询返回表 <code>h2o_feet</code>中列名（Field Key）包含<code>level</code>的所有数值类型的列的最大值。</p><p><strong>查询指定Field列的最大值，以及相关的Tag和Field</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;location&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;level description&quot;</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+-------+--------------+---------------------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> max   <span class="token operator">|</span> location     <span class="token operator">|</span> <span class="token keyword">level</span> description         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+--------------+---------------------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T07:<span class="token number">24</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">9.964</span> <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> at <span class="token operator">or</span> greater than <span class="token number">9</span> feet <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+--------------+---------------------------+</span>
<span class="token number">4</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>指定时间范围，并按时间分组查询每组最大值</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span> <span class="token keyword">WHERE</span> <span class="token keyword">time</span> <span class="token operator">&gt;=</span> <span class="token string">&#39;2019-08-20T00:12:01Z&#39;</span> <span class="token operator">AND</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token string">&#39;2019-08-20T08:00:00Z&#39;</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">time</span><span class="token punctuation">(</span><span class="token number">7</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span> fill<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token keyword">LIMIT</span> <span class="token number">4</span>
name: h2o_feet
tags: location<span class="token operator">=</span>coyote_creek
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> max   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">10</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">1000</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">17</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.684</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">24</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.661</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">31</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.619</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该查询返回表 <code>h2o_feet</code>中 <code>water_level</code> 列对应的最大值（Field value），指定时间范围为<code>2019-08-20T00:12:01Z</code>和<code>2019-08-20T08:00:00Z</code>，并将查询结果按7分钟的时间间隔和每个Tag进行分组，同时，若分组为空值，用<code>1000</code>填充，并将返回4条结果数据。</p><h2 id="min" tabindex="-1"><a class="header-anchor" href="#min" aria-hidden="true">#</a> MIN()</h2><p>返回指定Field列的最小值。不支持对Tag进行计算，不支持SLIMIT和SOFFSET。</p><p><strong>语法</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>field_key<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>tag_key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token operator">|</span><span class="token operator">&lt;</span>field_key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>INTO_CLAUSE<span class="token punctuation">]</span> FROM_CLAUSE <span class="token punctuation">[</span>WHERE_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>GROUP_BY_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>ORDER_BY_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>LIMIT_CLAUSE<span class="token punctuation">]</span> <span class="token punctuation">[</span>OFFSET_CLAUSE<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>示例</strong></p><p><strong>查询指定Field列的最小值</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> min   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T14:<span class="token number">30</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">-</span><span class="token number">0.61</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>查询所有Field列的最小值</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+-----------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> min_water_level <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-----------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T14:<span class="token number">30</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">-</span><span class="token number">0.61</span>           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-----------------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>表h2o_feet共有Field列两个：<code>water_level</code>和<code>level_description</code>，<code>MIN</code>仅支持对数值类型进行计算，因此不会有<code>level_description</code>。此外，如果存在数值类型的多列，返回值的<code>time</code>则为0，因为每列最小值所对应的时间可能不一致。</p><p><strong>正则表达式的使用</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token keyword">level</span><span class="token operator">/</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+-----------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> min_water_level <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-----------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T14:<span class="token number">30</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">-</span><span class="token number">0.61</span>           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-----------------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该查询返回表 <code>h2o_feet</code>中列名（Field Key）包含<code>level</code>的所有数值类型的列的最小值。</p><p><strong>查询指定Field列的最小值，以及相关的Tag和Field</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;location&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;level description&quot;</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+-------+--------------+-------------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> min   <span class="token operator">|</span> location     <span class="token operator">|</span> <span class="token keyword">level</span> description <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+--------------+-------------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T14:<span class="token number">30</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">-</span><span class="token number">0.61</span> <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> below <span class="token number">3</span> feet      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+--------------+-------------------+</span>
<span class="token number">4</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>指定时间范围，并按时间分组查询每组最小值</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span> <span class="token keyword">WHERE</span> <span class="token keyword">time</span> <span class="token operator">&gt;=</span> <span class="token string">&#39;2019-08-20T00:12:01Z&#39;</span> <span class="token operator">AND</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token string">&#39;2019-08-20T08:00:00Z&#39;</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">time</span><span class="token punctuation">(</span><span class="token number">7</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span> fill<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token keyword">LIMIT</span> <span class="token number">4</span>
name: h2o_feet
tags: location<span class="token operator">=</span>coyote_creek
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> min   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">10</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">1000</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">17</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.684</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">24</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.655</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">31</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.619</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该查询返回表 <code>h2o_feet</code>中 <code>water_level</code> 列对应的最大值（Field value），指定时间范围为<code>2019-08-20T00:12:01Z</code>和<code>2019-08-20T08:00:00Z</code>，并将查询结果按7分钟的时间间隔和每个Tag进行分组，同时，若分组为空值，用<code>1000</code>填充，并将返回4条结果数据。</p><h2 id="top" tabindex="-1"><a class="header-anchor" href="#top" aria-hidden="true">#</a> TOP()</h2><p>返回指定Field列最大的N个值，不支持使用*表示所有列，</p><p><strong>语法</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">TOP</span><span class="token punctuation">(</span> <span class="token operator">&lt;</span>field_key<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>tag_key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>N<span class="token operator">&gt;</span> <span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>tag_key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token operator">|</span><span class="token operator">&lt;</span>field_key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>INTO_clause<span class="token punctuation">]</span> FROM_clause <span class="token punctuation">[</span>WHERE_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>GROUP_BY_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>ORDER_BY_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>LIMIT_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>OFFSET_clause<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>示例</strong></p><p><strong>查询指定Field列最大的3个值</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token keyword">TOP</span><span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> <span class="token keyword">top</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T07:<span class="token number">18</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">9.957</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T07:<span class="token number">24</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">9.964</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T07:<span class="token number">30</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">9.954</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>查询指定Field列最大的3个值，以及相关的Tag和Field</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token keyword">TOP</span><span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;location&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;level description&quot;</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+-------+--------------+---------------------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> <span class="token keyword">top</span>   <span class="token operator">|</span> location     <span class="token operator">|</span> <span class="token keyword">level</span> description         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+--------------+---------------------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T07:<span class="token number">18</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">9.957</span> <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> at <span class="token operator">or</span> greater than <span class="token number">9</span> feet <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T07:<span class="token number">24</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">9.964</span> <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> at <span class="token operator">or</span> greater than <span class="token number">9</span> feet <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T07:<span class="token number">30</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">9.954</span> <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> at <span class="token operator">or</span> greater than <span class="token number">9</span> feet <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------+--------------+---------------------------+</span>
<span class="token number">4</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>指定时间范围，并按时间分组查询每组最大3个值</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token keyword">TOP</span><span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span> <span class="token keyword">WHERE</span> <span class="token keyword">time</span> <span class="token operator">&gt;=</span> <span class="token string">&#39;2019-08-20T00:12:01Z&#39;</span> <span class="token operator">AND</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token string">&#39;2019-08-20T08:00:00Z&#39;</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">time</span><span class="token punctuation">(</span><span class="token number">1</span>h<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span> fill<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token keyword">LIMIT</span> <span class="token number">4</span>
name: h2o_feet
tags: location<span class="token operator">=</span>coyote_creek
<span class="token operator">+</span><span class="token comment">----------------------+-------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> <span class="token keyword">top</span>         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">18</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.684</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">24</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.661</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">30</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.655</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T01:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.415</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T01:<span class="token number">06</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.34</span>        <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T01:<span class="token number">12</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.258</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T02:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">7.382</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T02:<span class="token number">06</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">7.274</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T02:<span class="token number">12</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">7.156</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T03:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">6.273</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T03:<span class="token number">06</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">6.126144142</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T03:<span class="token number">12</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">6.017</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">12</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在分组的情况下，<code>LIMIT 4</code> 表示返回4个分组，每个分组包含3个最大值，因此返回总数据量是12条。</p><h2 id="bottom" tabindex="-1"><a class="header-anchor" href="#bottom" aria-hidden="true">#</a> BOTTOM()</h2><p>返回指定Field列最小的N个值，不支持使用*表示所有列，不支持SLIMIT和SOFFSET。</p><p><strong>语法</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> BOTTOM<span class="token punctuation">(</span> <span class="token operator">&lt;</span>field_key<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>tag_key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>N<span class="token operator">&gt;</span> <span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>tag_key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token operator">|</span><span class="token operator">&lt;</span>field_key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>INTO_clause<span class="token punctuation">]</span> FROM_clause <span class="token punctuation">[</span>WHERE_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>GROUP_BY_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>ORDER_BY_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>LIMIT_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>OFFSET_clause<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>示例</strong></p><p><strong>查询指定Field列最大的3个值</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> BOTTOM<span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+--------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> bottom <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+--------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T14:<span class="token number">30</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">-</span><span class="token number">0.61</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T14:<span class="token number">36</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">-</span><span class="token number">0.591</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">29</span>T15:<span class="token number">18</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">-</span><span class="token number">0.594</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+--------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>查询指定Field列最大的3个值，以及相关的Tag和Field</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> BOTTOM<span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;location&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;level description&quot;</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+--------+--------------+-------------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> bottom <span class="token operator">|</span> location     <span class="token operator">|</span> <span class="token keyword">level</span> description <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+--------+--------------+-------------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T14:<span class="token number">30</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">-</span><span class="token number">0.61</span>  <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> below <span class="token number">3</span> feet      <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>T14:<span class="token number">36</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">-</span><span class="token number">0.591</span> <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> below <span class="token number">3</span> feet      <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">29</span>T15:<span class="token number">18</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token operator">-</span><span class="token number">0.594</span> <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> below <span class="token number">3</span> feet      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+--------+--------------+-------------------+</span>
<span class="token number">4</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>指定时间范围，并按时间分组查询每组最大3个值</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> BOTTOM<span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span> <span class="token keyword">WHERE</span> <span class="token keyword">time</span> <span class="token operator">&gt;=</span> <span class="token string">&#39;2019-08-20T00:12:01Z&#39;</span> <span class="token operator">AND</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token string">&#39;2019-08-20T08:00:00Z&#39;</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">time</span><span class="token punctuation">(</span><span class="token number">1</span>h<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span> fill<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token keyword">LIMIT</span> <span class="token number">4</span>
name: h2o_feet
tags: location<span class="token operator">=</span>coyote_creek
<span class="token operator">+</span><span class="token comment">----------------------+--------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> bottom <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+--------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">42</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.593</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">48</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.56</span>   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">54</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.481</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T01:<span class="token number">42</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">7.743</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T01:<span class="token number">48</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">7.631</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T01:<span class="token number">54</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">7.507</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T02:<span class="token number">42</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">6.621</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T02:<span class="token number">48</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">6.509</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T02:<span class="token number">54</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">6.378</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T03:<span class="token number">42</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">5.354</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T03:<span class="token number">48</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">5.23</span>   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T03:<span class="token number">54</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">5.098</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+--------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">12</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在分组的情况下，<code>LIMIT 4</code> 表示返回4个分组，每个分组包含3个最小值，因此返回总数据量是12条。</p><h2 id="percentile" tabindex="-1"><a class="header-anchor" href="#percentile" aria-hidden="true">#</a> PERCENTILE()</h2><p>返回指定Field列的第N百分位数，N属于[0,100]。百分位数用P加下标表示，如P<sub>30</sub> = 60，表示目标数据中小于60的占比30%。 不支持SLIMIT和SOFFSET。</p><p><strong>语法</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> PERCENTILE<span class="token punctuation">(</span><span class="token operator">&lt;</span>field_key<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>N<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>tag_key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token operator">|</span><span class="token operator">&lt;</span>field_key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>INTO_clause<span class="token punctuation">]</span> FROM_clause <span class="token punctuation">[</span>WHERE_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>GROUP_BY_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>ORDER_BY_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>LIMIT_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>OFFSET_clause<span class="token punctuation">]</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>示例</strong></p><p><strong>查询指定Field列的P<sub>90</sub></strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> PERCENTILE<span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> percentile <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">13</span>T19:<span class="token number">36</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">7.969</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+------------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>表示<code>water_level</code>列90%的数小于<code>7.969</code></p><p><strong>查询指定Field列的P<sub>90</sub>，以及相关的Tag和Field</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> PERCENTILE<span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;location&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;level description&quot;</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+------------+--------------+----------------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> percentile <span class="token operator">|</span> location     <span class="token operator">|</span> <span class="token keyword">level</span> description    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+------------+--------------+----------------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">13</span>T19:<span class="token number">36</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">7.969</span>      <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">6</span> <span class="token operator">and</span> <span class="token number">9</span> feet <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+------------+--------------+----------------------+</span>
<span class="token number">4</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>指定时间范围，并按时间分组查询每组的P<sub>90</sub></strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> PERCENTILE<span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;location&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;level description&quot;</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span> <span class="token keyword">WHERE</span> <span class="token keyword">time</span> <span class="token operator">&gt;=</span> <span class="token string">&#39;2019-08-20T00:12:01Z&#39;</span> <span class="token operator">AND</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token string">&#39;2019-08-21T08:00:00Z&#39;</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">time</span><span class="token punctuation">(</span><span class="token number">12</span>h<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span> fill<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
name: h2o_feet
tags: location<span class="token operator">=</span>coyote_creek
<span class="token operator">+</span><span class="token comment">----------------------+------------+--------------+----------------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> percentile <span class="token operator">|</span> location     <span class="token operator">|</span> <span class="token keyword">level</span> description    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+------------+--------------+----------------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">7.959</span>      <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">6</span> <span class="token operator">and</span> <span class="token number">9</span> feet <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T12:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">7.49</span>       <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">6</span> <span class="token operator">and</span> <span class="token number">9</span> feet <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">21</span>T00:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.491</span>      <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">6</span> <span class="token operator">and</span> <span class="token number">9</span> feet <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+------------+--------------+----------------------+</span>
<span class="token number">4</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>

name: h2o_feet
tags: location<span class="token operator">=</span>santa_monica
<span class="token operator">+</span><span class="token comment">----------------------+------------+--------------+----------------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> percentile <span class="token operator">|</span> location     <span class="token operator">|</span> <span class="token keyword">level</span> description    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+------------+--------------+----------------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T00:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">3.704</span>      <span class="token operator">|</span> santa_monica <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">3</span> <span class="token operator">and</span> <span class="token number">6</span> feet <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T12:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">4.797</span>      <span class="token operator">|</span> santa_monica <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">3</span> <span class="token operator">and</span> <span class="token number">6</span> feet <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">21</span>T00:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">3.678</span>      <span class="token operator">|</span> santa_monica <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">3</span> <span class="token operator">and</span> <span class="token number">6</span> feet <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+------------+--------------+----------------------+</span>
<span class="token number">4</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="sample" tabindex="-1"><a class="header-anchor" href="#sample" aria-hidden="true">#</a> SAMPLE()</h2><p>随机返回指定Field列的N个样本数据。不支持SLIMIT和SOFFSET。</p><p><strong>语法</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> SAMPLE<span class="token punctuation">(</span><span class="token operator">&lt;</span>field_key<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>N<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>tag_key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token operator">|</span><span class="token operator">&lt;</span>field_key<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>INTO_clause<span class="token punctuation">]</span> FROM_clause <span class="token punctuation">[</span>WHERE_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>GROUP_BY_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>ORDER_BY_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>LIMIT_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>OFFSET_clause<span class="token punctuation">]</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>示例</strong></p><p><strong>随机采样指定Field列5个数</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># 第一次执行</span>
<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> SAMPLE<span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+--------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> sample <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+--------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">23</span>T06:<span class="token number">30</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">1.355</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">31</span>T11:<span class="token number">24</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.533</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">02</span>T04:<span class="token number">48</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">2.536</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">13</span>T07:<span class="token number">54</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">8.806</span>  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">15</span>T10:<span class="token number">42</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">2.602</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+--------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
<span class="token comment"># 第二次执行</span>
<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> SAMPLE<span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+-------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> sample      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>T06:<span class="token number">48</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">2.159</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">30</span>T03:<span class="token number">06</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">4.728</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">09</span>T21:<span class="token number">24</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">7.126144146</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">10</span>T23:<span class="token number">48</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">4.656</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">14</span>T18:<span class="token number">24</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">5.86</span>        <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+-------------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>每次都是随机选择，因此返回的结果也不相同。</p><p><strong>返回采样数据相关的Tag和其他Field值</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> SAMPLE<span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;location&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;level description&quot;</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+--------+--------------+----------------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> sample <span class="token operator">|</span> location     <span class="token operator">|</span> <span class="token keyword">level</span> description    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+--------+--------------+----------------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">17</span>T21:<span class="token number">18</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">4.075</span>  <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> below <span class="token number">3</span> feet         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">07</span>T09:<span class="token number">36</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">2.726</span>  <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> below <span class="token number">3</span> feet         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">08</span>T14:<span class="token number">54</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">3.514</span>  <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">3</span> <span class="token operator">and</span> <span class="token number">6</span> feet <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">09</span>T09:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">0.919</span>  <span class="token operator">|</span> santa_monica <span class="token operator">|</span> below <span class="token number">3</span> feet         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">13</span>T06:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">6.119</span>  <span class="token operator">|</span> coyote_creek <span class="token operator">|</span> <span class="token operator">between</span> <span class="token number">6</span> <span class="token operator">and</span> <span class="token number">9</span> feet <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+--------+--------------+----------------------+</span>
<span class="token number">4</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="percentile-ogsketch" tabindex="-1"><a class="header-anchor" href="#percentile-ogsketch" aria-hidden="true">#</a> PERCENTILE_OGSKETCH()</h2><p>返回指定Field列的第N个近似百分位数，N属于[0,100]，近似百分位数顾名思义对百分位数的计算是一个近似值，不是准确值。相比PERCENTILE()计算数速度更快，适合针对大数据集求解包分位数的场景。</p><p>语法</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> PERCENTILE_OGSKETCH<span class="token punctuation">(</span><span class="token operator">&lt;</span>field_key<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>N<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>INTO_clause<span class="token punctuation">]</span> FROM_clause <span class="token punctuation">[</span>WHERE_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>GROUP_BY_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>ORDER_BY_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>LIMIT_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>OFFSET_clause<span class="token punctuation">]</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>示例</p><p><strong>查询指定Field列的近似P<sub>90</sub></strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">#准确值</span>
<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> PERCENTILE<span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> percentile <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">13</span>T19:<span class="token number">36</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">7.969</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+------------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>

<span class="token comment">#近似值</span>
<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> PERCENTILE_OGSKETCH<span class="token punctuation">(</span><span class="token string">&quot;water_level&quot;</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">&quot;h2o_feet&quot;</span>
name: h2o_feet
<span class="token operator">+</span><span class="token comment">----------------------+---------------------+</span>
<span class="token operator">|</span> <span class="token keyword">time</span>                 <span class="token operator">|</span> percentile_ogsketch <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+---------------------+</span>
<span class="token operator">|</span> <span class="token number">1970</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>T00:<span class="token number">00</span>:<span class="token number">00</span>Z <span class="token operator">|</span> <span class="token number">7.974716590327904</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+---------------------+</span>
<span class="token number">2</span> <span class="token keyword">columns</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,124);function v(g,w){const e=r("ExternalLinkIcon");return o(),t("div",null,[k,s("div",u,[i,s("p",null,[n("openGemini提供的函数兼容InfluxDB的用法，可参考InfluxDB对应的"),s("a",d,[n("函数用法"),l(e)]),n("。")]),m]),b])}const _=p(c,[["render",v],["__file","selector.html.vue"]]);export{_ as default};
